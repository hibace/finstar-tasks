# SQL функция для расчета поденных сумм платежей

## Описание
Функция `GetDailyPayments` предназначена для расчета ежедневных сумм платежей клиента за указанный период времени.

## Параметры
- `p_ClientId` (BIGINT) - идентификатор клиента
- `p_StartDate` (DATE) - начальная дата периода
- `p_EndDate` (DATE) - конечная дата периода

## Возвращаемые данные
Таблица со следующими колонками:
- `PaymentDate` (DATE) - дата платежа
- `Amount` (MONEY) - сумма платежа за день (0, если платежей не было)

## Примеры использования

### Пример 1
```sql
-- Получение платежей клиента 1 за период с 02.01.2022 по 07.01.2022
SELECT * FROM GetDailyPayments(1, '2022-01-02', '2022-01-07');
```

Ожидаемый результат:
```
PaymentDate | Amount
------------|--------
2022-01-02 | 0
2022-01-03 | 100
2022-01-04 | 0
2022-01-05 | 450
2022-01-06 | 0
2022-01-07 | 50
```

### Пример 2
```sql
-- Получение платежей клиента 2 за период с 04.01.2022 по 11.01.2022
SELECT * FROM GetDailyPayments(2, '2022-01-04', '2022-01-11');
```

Ожидаемый результат:
```
PaymentDate | Amount
------------|--------
2022-01-04 | 0
2022-01-05 | 278
2022-01-06 | 0
2022-01-07 | 0
2022-01-08 | 0
2022-01-09 | 0
2022-01-10 | 300
2022-01-11 | 0
```

## Особенности реализации
1. Использует рекурсивное CTE для генерации последовательности дат
2. Оптимизирована для работы с большими объемами данных
3. Корректно обрабатывает отсутствие платежей (возвращает 0)
4. Поддерживает интервалы дат любой длины
5. Результаты сортируются по дате

## Требования
- PostgreSQL 9.6 или выше
- Таблица `ClientPayments` с соответствующей структурой

## Установка
1. Создайте таблицу `ClientPayments` (если не существует)
2. Выполните скрипт создания функции `function.sql`
3. При необходимости загрузите тестовые данные из `test_data.sql` 